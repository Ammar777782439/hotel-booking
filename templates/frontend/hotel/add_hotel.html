
{% extends "frontend/layout/master.html" %}
{% load static %}

{% block extra_css %}
<style>
    /* تنسيق حقول الإدخال */
    .form-control.is-invalid {
        border-color: #dc3545;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: left calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
        padding-left: calc(1.5em + 0.75rem);
    }

    .form-control.is-valid {
        border-color: #28a745;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: left calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
        padding-left: calc(1.5em + 0.75rem);
    }

    .invalid-feedback {
        display: none;
        width: 100%;
        margin-top: 0.25rem;
        font-size: 80%;
        color: #dc3545;
    }
</style>
{% endblock %}

{% block content %}
<section class="add-hotel-area padding-top-100px padding-bottom-100px">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="form-box">
                    <div class="form-title-wrap">
                        <h3 class="title font-size-22">طلب إضافة فندق جديد</h3>
                        <p class="font-size-14">سيتم مراجعة طلبك من قبل مدير النظام</p>
                    </div>
                    <div class="form-content">
                        <div class="contact-form-action">
                            <form method="post" enctype="multipart/form-data">
                                {% csrf_token %}

                                <!-- معلومات المستخدم -->
                                <div class="form-group mb-4">
                                    <h5 class="title font-size-16 mb-3">معلوماتك الشخصية</h5>
                                    <div class="row">
                                        <div class="col-lg-4">
                                            <div class="input-box">
                                                <label class="label-text">الاسم</label>
                                                <div class="form-group">
                                                    {{ form.name }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="input-box">
                                                <label class="label-text">البريد الإلكتروني</label>
                                                <div class="form-group">
                                                    {{ form.email }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <div class="input-box">
                                                <label class="label-text">دورك في العمل</label>
                                                <div class="form-group">
                                                    <input type="text" name="role" value="مدير فندق" class="form-control" readonly>
                                                    <small class="text-muted">سيتم تسجيلك كمدير فندق</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- معلومات الفندق -->
                                <div class="form-group mb-4">
                                    <h5 class="title font-size-16 mb-3">معلومات الفندق</h5>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="input-box">
                                                <label class="label-text">اسم الفندق</label>
                                                <div class="form-group">
                                                    {{ form.hotel_name }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="input-box">
                                                <label class="label-text">وصف الفندق</label>
                                                <div class="form-group">
                                                    {{ form.description }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="input-box">
                                                <label class="label-text">صورة الفندق الرئيسية</label>
                                                <div class="form-group">
                                                    {{ form.profile_picture }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- معلومات الرخصة والمستندات -->
                                <div class="form-group mb-4">
                                    <h5 class="title font-size-16 mb-3">معلومات الرخصة والمستندات</h5>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="input-box">
                                                <label class="label-text">رقم الرخصة التجارية</label>
                                                <div class="form-group">
                                                    {{ form.business_license_number }}
                                                </div>
                                                <small class="text-muted">أدخل رقم الرخصة التجارية الخاصة بالفندق</small>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="input-box">
                                                <label class="label-text">المستندات الرسمية</label>
                                                <div class="form-group">
                                                    {{ form.document_path }}
                                                </div>
                                                <small class="text-muted">قم بإرفاق المستندات الرسمية (رخصة العمل، السجل التجاري، إلخ)</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- معلومات الموقع -->
                                <div class="form-group mb-4">
                                    <h5 class="title font-size-16 mb-3">موقع الفندق</h5>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="input-box">
                                                <label class="label-text">الدولة</label>
                                                <div class="form-group">
                                                    <select name="country" id="countrySelect" class="form-control" required readonly>
                                                        <option value="اليمن" selected>اليمن</option>
                                                    </select>
                                                    <small class="text-muted">متاح حاليًا للفنادق في اليمن فقط</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="input-box">
                                                <label class="label-text">المحافظة</label>
                                                <div class="form-group">
                                                    <select name="state" id="stateSelect" class="form-control" required>
                                                        <option value="">-- اختر المحافظة --</option>
                                                        {% for city in cities %}
                                                            <option value="{{ city.state }}">{{ city.state }}</option>
                                                        {% endfor %}
                                                        <option value="new">إضافة محافظة جديدة</option>
                                                    </select>
                                                    <input type="text" name="new_state" id="newStateInput" class="form-control mt-2" style="display: none;" placeholder="أدخل اسم المحافظة الجديدة">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-12 mt-3">
                                            <div class="input-box">
                                                <label class="label-text">العنوان التفصيلي</label>
                                                <div class="form-group">
                                                    {{ form.address }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- معلومات الاتصال -->
                                <div class="form-group mb-4">
                                    <h5 class="title font-size-16 mb-3">معلومات الاتصال</h5>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="input-box">
                                                <label class="label-text">رمز الدولة</label>
                                                <div class="form-group">
                                                    <input type="text" name="country_code" value="+967" class="form-control" readonly required>
                                                    <small class="text-muted">رمز الدولة للجمهورية اليمنية</small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="input-box">
                                                <label class="label-text">رقم الهاتف</label>
                                                <div class="form-group">
                                                    <input type="tel" name="phone_number" id="phone_number" class="form-control"
                                                           placeholder="أدخل رقم الهاتف (9 أرقام فقط)"
                                                           maxlength="9"
                                                           pattern="[0-9]{9}"
                                                           title="يرجى إدخال 9 أرقام فقط"
                                                           required>
                                                    <small class="text-muted">أدخل 9 أرقام فقط بدون رمز الدولة</small>
                                                    <div id="phone_error" class="invalid-feedback" style="display: none;">
                                                        يجب أن يتكون رقم الهاتف من 9 أرقام فقط
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- الصور الإضافية -->
                                <div class="form-group mb-4">
                                    <h5 class="title font-size-16 mb-3">صور إضافية للفندق</h5>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="input-box">
                                                <div class="form-group">
                                                    <input type="file" name="additional_images" class="form-control" multiple accept="image/*">
                                                </div>
                                                <small class="text-muted">يمكنك اختيار أكثر من صورة</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {% if form.errors %}
                                <div class="alert alert-danger">
                                    <h5>يرجى تصحيح الأخطاء التالية:</h5>
                                    {{ form.errors }}
                                </div>
                                {% endif %}

                                <div class="btn-box pt-3">
                                    <button type="submit" class="theme-btn">إرسال طلب إضافة الفندق</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}


{% block extra_js %}
<script>
    $(document).ready(function() {
        function toggleCityFields() {
            var useExisting = $('#use_existing_city').is(':checked');
            if (useExisting) {
                $('#existing_city_div').show();
                $('#new_city_div').hide();
                $('#new_city').val('');  // مسح قيمة المدينة الجديدة
            } else {
                $('#existing_city_div').hide();
                $('#new_city_div').show();
                $('#existing_city').val('');  // مسح اختيار المدينة الموجودة
            }
        }

        // تشغيل الدالة عند تحميل الصفحة
        toggleCityFields();

        // تشغيل الدالة عند تغيير الاختيار
        $('#use_existing_city').change(function() {
            toggleCityFields();
        });

        // عند اختيار مدينة موجودة
        $('#existing_city').change(function() {
            var selectedCity = $(this).find('option:selected');
            if (selectedCity.val()) {
                $('#country').val(selectedCity.data('country'));
            }
        });

        // تحسين شكل حقل اختيار الملفات
        $('input[type="file"]').change(function() {
            var fileName = $(this).val().split('\\').pop();
            if (fileName) {
                $(this).next('.custom-file-label').html(fileName);
            }
        });

        // التحقق من رقم الهاتف
        $('#phone_number').on('input', function() {
            validatePhoneNumber();
        });

        // التحقق من النموذج قبل الإرسال
        $('form').submit(function(event) {
            if (!validatePhoneNumber()) {
                event.preventDefault();
            }
        });

        function validatePhoneNumber() {
            var phoneNumber = $('#phone_number').val();
            var phoneError = $('#phone_error');
            var isValid = true;

            // التحقق من أن رقم الهاتف يتكون من 9 أرقام فقط
            if (phoneNumber.length !== 9 || !/^\d{9}$/.test(phoneNumber)) {
                phoneError.show();
                $('#phone_number').addClass('is-invalid');
                isValid = false;
            } else {
                phoneError.hide();
                $('#phone_number').removeClass('is-invalid').addClass('is-valid');
            }

            return isValid;
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var citySelect = document.getElementById('id_city_choice');
        var newCityInput = document.getElementById('id_new_city_name');

        function toggleNewCityInput() {
            if (citySelect && citySelect.value === 'new') {
                if (newCityInput) newCityInput.style.display = 'block';
            } else {
                if (newCityInput) newCityInput.style.display = 'none';
            }
        }

        // عند تغيير الاختيار
        if (citySelect) {
            citySelect.addEventListener('change', toggleNewCityInput);
            // عند تحميل الصفحة
            toggleNewCityInput();
        }
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // حقل المحافظة فقط
        const stateSelect = document.getElementById('stateSelect');
        const newStateInput = document.getElementById('newStateInput');

        if (stateSelect) {
            stateSelect.addEventListener('change', function() {
                if (this.value === 'new') {
                    if (newStateInput) newStateInput.style.display = 'block';
                } else {
                    if (newStateInput) newStateInput.style.display = 'none';
                }
            });
        }

        // التحقق من رقم الهاتف عند تحميل الصفحة
        const phoneInput = document.getElementById('phone_number');
        if (phoneInput) {
            phoneInput.addEventListener('input', function() {
                // التحقق من أن الإدخال أرقام فقط
                this.value = this.value.replace(/[^0-9]/g, '');

                // التحقق من الطول
                if (this.value.length > 9) {
                    this.value = this.value.slice(0, 9);
                }

                // إظهار أو إخفاء رسالة الخطأ
                const errorElement = document.getElementById('phone_error');
                if (this.value.length !== 9) {
                    this.classList.add('is-invalid');
                    if (errorElement) errorElement.style.display = 'block';
                } else {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                    if (errorElement) errorElement.style.display = 'none';
                }
            });
        }
    });
</script>
{% endblock %}