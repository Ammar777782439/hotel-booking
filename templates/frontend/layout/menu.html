{% load menu_generator %}
{% load static %}
<style>
    /* الألوان حسب نوع الإشعار */
    .notification-message.info {
        background-color: #b0d3f5;
        color: #000000;
        border-left: 5px solid #3178c6;
    }

    .notification-message.warning {
        background-color: #eeca99;
        color: #000000;
        border-left: 5px solid #d6822c; 
    }

    .notification-message.success {
        background-color: #adf5ad;
        color: #000000;
        border-left: 5px solid #28a745;
    }

    .notification-message.error {
        background-color: #efa9a1;
        color: #000000;
        border-left: 5px solid #dc3545;
    }

    /* تحسين عرض الإشعارات */
    .notification-container .noti-content {
        max-height: 300px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .notification-container .notification-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .notification-container .notification-message {
        border-bottom: 1px solid #f0f0f0;
        padding: 10px 15px;
    }

    .notification-time {
        font-size: 12px;
        color: #888;
    }

    .notification-title {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .noti-details {
        color: #555;
        font-size: 14px;
    }

    .notify-block {
        display: flex;
        align-items: center;
    }

    .avatar {
        margin-right: 10px;
    }

    .avatar-img {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        object-fit: cover;
    }

    /* تهيئة البادج للإشعارات */
    .badge.bg-danger {
        font-size: 12px;
        padding: 4px 7px;
        position: absolute;
        top: 10px;
        right: 10px;
        .notification-container {
    position: relative;
    display: inline-block;
}

.notification-container .fa-bell {
    font-size: 24px;
    color: #333;
    cursor: pointer;
}

.notification-container .badge {
    font-size: 12px;
    position: absolute;
    top: -5px;
    right: -5px;
    background-color: red;
    color: white;
    border-radius: 50%;
    padding: 4px 7px;
    display: none; 
}

    }
</style>
<header class="header-area">
  <div class="header-top-bar padding-right-100px padding-left-100px">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-lg-6">
          <div class="header-top-content">
            <div class="header-left">
              <ul class="list-items">
                <li>
                  <a href="#"><i class="la la-phone me-1"></i>(123) 123-456</a>
                </li>
                <li>
                  <a href="#"><i class="la la-envelope me-1"></i>trizen@example.com</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="header-top-content">
            <div class="header-right d-flex align-items-center justify-content-end">
              <div class="header-right-action">
                <div class="select-contain select--contain w-auto">
                  <select class="select-contain-select">
                    <option data-content='<span class="flag-icon flag-icon-id me-1"></span> Bahasa Indonesia'>Bahasa Indonesia</option>
                    <option data-content='<span class="flag-icon flag-icon-de me-1"></span> Deutsch'>Deutsch</option>
                    <option data-content='<span class="flag-icon flag-icon-us me-1"></span> English(US)' selected>English US</option>
                    <option data-content='<span class="flag-icon flag-icon-gb-eng me-1"></span> English(UK)'>English UK</option>
                    <option data-content='<span class="flag-icon flag-icon-ro me-1"></span> Romanian'>Romanian</option>
                    <option data-content='<span class="flag-icon flag-icon-es me-1"></span> Español'>Español</option>
                    <option data-content='<span class="flag-icon flag-icon-fr me-1"></span> Francais'>Francais</option>
                    <option data-content='<span class="flag-icon flag-icon-it me-1"></span> Italiano'>Italiano</option>
                    <option data-content='<span class="flag-icon flag-icon-pl me-1"></span> Polski'>Polski</option>
                    <option data-content='<span class="flag-icon flag-icon-pt me-1"></span> Portuguese'>Portuguese</option>
                    <option data-content='<span class="flag-icon flag-icon-tr me-1"></span> Turkish'>Turkish</option>
                    <option data-content='<span class="flag-icon flag-icon-ru me-1"></span> Russian'>Russian</option>
                    <option data-content='<span class="flag-icon flag-icon-jp me-1"></span> Japanese'>Japanese</option>
                    <option data-content='<span class="flag-icon flag-icon-cn me-1"></span> Mandarin'>Mandarin</option>
                    <option data-content='<span class="flag-icon flag-icon-tw me-1"></span> Mandarin Chinese'>Mandarin Chinese</option>
                    <option data-content='<span class="flag-icon flag-icon-kr me-1"></span> Korean'>Korean</option>
                    <option data-content='<span class="flag-icon flag-icon-in me-1"></span> Hindi'>Hindi</option>
                  </select>
                </div>
              </div>
              <div class="header-right-action">
                <div class="select-contain select--contain w-auto">
                  <select class="select-contain-select">
                    <option value="1">AED</option>
                    <option value="2">AUD</option>
                    <option value="3">BRL</option>
                    <option value="4">CAD</option>
                    <option value="5">CHF</option>
                    <option value="6">CNY</option>
                    <option value="7">EUR</option>
                    <option value="8">GBP</option>
                    <option value="9">HKD</option>
                    <option value="10">IDR</option>
                    <option value="11">INR</option>
                    <option value="12">JPY</option>
                    <option value="13">KRW</option>
                    <option value="14">MYR</option>
                    <option value="15">NZD</option>
                    <option value="16">PHP</option>
                    <option value="17">PLN</option>
                    <option value="18">RUB</option>
                    <option value="19">SAR</option>
                    <option value="20">SGD</option>
                    <option value="21">THB</option>
                    <option value="22">TRY</option>
                    <option value="23">TWD</option>
                    <option value="24" selected>USD</option>
                    <option value="25">VND</option>
                    <option value="26">MXN</option>
                    <option value="27">ARS</option>
                    <option value="28">INR</option>
                  </select>
                </div>
              </div>
                                  <!-- Notifications -->
                                  <div class="notification-container">
                                    <li class="nav-item dropdown noti-nav me-3 pe-0">
                                        <a href="#" class="dropdown-toggle nav-link p-0" data-bs-toggle="dropdown" aria-expanded="false" id="notification-button">
                                            <i class="fa-solid fa-bell"></i>
                                            {% if unread_notifications_count > 0 %}
                                            <span class="badge bg-danger" id="notification-count">{{ unread_notifications_count }}</span>
                                            {% endif %}
                                        </a>
                                        <div class="dropdown-menu notifications dropdown-menu-end" id="notification-dropdown">
                                            <div class="topnav-dropdown-header">
                                                <span class="notification-title">الإشعارات</span>
                                            </div>
                                            <div class="noti-content">
                                                <ul class="notification-list" id="notification-list">
                                                    {% for notification in notifications %}
                                                        {% if notification.status == '0' %}
                                                        <li class="notification-message 
                                                            {% if notification.notification_type == '0' %}info{% endif %}
                                                            {% if notification.notification_type == '1' %}warning{% endif %}
                                                            {% if notification.notification_type == '2' %}success{% endif %}
                                                            {% if notification.notification_type == '3' %}error{% endif %}">
                                                            <a href="#">
                                                                <div class="notify-block d-flex">
                                                                    {% if notification.image %}
                                                                    <span class="avatar">
                                                                        <img class="avatar-img" alt="Notification Image" src="{{ notification.image.url }}">
                                                                    </span>
                                                                    {% endif %}
                                                                    <div class="media-body">
                                                                        <p class="noti-details">
                                                                            {{ notification.message }}
                                                                        </p>
                                                                        <h6>{{ notification.sender.name }} 
                                                                            <span class="notification-time">
                                                                                {{ notification.send_time|date:"H:i A" }}
                                                                                <br>
                                                                            <small>من: {{ notification.sender.username }}</small>
                                                                            </span>
                                                                        </h6>
                                                                        
                                                                    </div>
                                                                </div>
                                                            </a>
                                                        </li>
                                                        {% endif %}
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </li>
                                </div>
                                <!-- /Notifications -->
                                
              {% if request.user.is_authenticated %}
                <div class="header-right-action">
                  <div class="dropdown">
                    <button class="theme-btn theme-btn-small dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                      <i class="la la-user me-1"></i> {{ request.user.username }}
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="userDropdown">
                      <li><a class="dropdown-item" href="{% url 'customer:user_dashboard_index' %}"><i class="la la-user-circle me-2"></i>الملف الشخصي</a></li>
                      <li><a class="dropdown-item" href="{% url 'customer:user_dashboard_bookings' %}"><i class="la la-hotel me-2"></i>حجوزاتي</a></li>
                      {% if request.user.is_staff %}
                      <li><a class="dropdown-item" href="{% url 'admin:index' %}"><i class="la la-cog me-2"></i>لوحة التحكم</a></li>
                      {% endif %}
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item text-danger" href="{% url 'users:logout' %}"><i class="la la-sign-out me-2"></i>تسجيل خروج</a></li>
                    </ul>
                  </div>
                </div>
              {% else %}
                <div class="header-right-action">
                  <a href="#" class="theme-btn theme-btn-small theme-btn-transparent me-1" data-bs-toggle="modal" data-bs-target="#signupPopupForm">سجل</a>
                  <a href="#" class="theme-btn theme-btn-small" data-bs-toggle="modal" data-bs-target="#loginPopupForm">تسجيل الدخول</a>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="header-menu-wrapper padding-right-100px padding-left-100px">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div class="menu-wrapper justify-content-between">
            <a href="#" class="down-button"><i class="la la-angle-down"></i></a>
            <div class="logo">
              <a href="{% url 'home:index' %}"><img src="{% static 'images/logo.png' %}" alt="logo" /></a>
              <div class="menu-toggler">
                <i class="la la-bars"></i>
                <i class="la la-times"></i>
              </div>
            </div>
            
            <div class="main-menu-content pe-0 ms-0">
              <nav class="d-flex justify-content-center">
                {% get_menu "NAV_MENU_TOP" as top_menu %}
                <ul class="d-flex justify-content-center gap-4">
                  {% for item in top_menu %}
                  <li>
                    <a href="{{ item.url }}" class="px-2">
                      {{ item.name }}
                      {% if item.submenu %}
                      <i class="la la-angle-down"></i>
                      {% endif %}
                    </a>
                    {% if item.submenu %}
                    <ul class="dropdown-menu-item">
                      {% for menu in item.submenu %}
                      <li>
                        <a href="{{ menu.url }}">{{ menu.name }}</a>
                      </li>
                      {% endfor %}
                    </ul>
                    {% endif %}
                  </li>
                  {% endfor %}
                </ul>
              </nav>
              {% if not request.user.is_authenticated %}
              <div class="nav-btn">
                <a href="{% url 'HotelManagement:add_request' %}" class="theme-btn theme-btn-small">أضف فندقك الآن</a>
              </div>
              {% endif %}
            </div>
            

          </div>
        </div>
      </div>
    </div>
  </div>
</header>
<script>
  document.addEventListener("DOMContentLoaded", function () {
      var notificationButton = document.getElementById("notification-button");
      var notificationList = document.getElementById("notification-list");
      var notificationBadge = document.getElementById("notification-count");
  
      notificationButton.addEventListener("click", function () {
          // Toggle the display of the notification list
          notificationList.style.display = (notificationList.style.display === "block") ? "none" : "block";
      });
  
      // إضافة حدث للنقر على كل إشعار
      notificationList.addEventListener("click", function (event) {
          if (event.target.closest("li")) {
              var notificationItem = event.target.closest("li");
              // إرسال طلب Ajax لجعل الإشعار مقروء
              fetch("{% url 'mark_notifications_read' %}", {
                  method: "POST",
                  headers: {
                      "X-CSRFToken": "{{ csrf_token }}",
                      "Content-Type": "application/json"
                  },
                  body: JSON.stringify({ notification_id: notificationItem.dataset.id })  // إرسال ID الإشعار
              })
              .then(response => response.json())
              .then(data => {
                  if (data.success) {
                      notificationItem.style.display = "none"; // إخفاء الإشعار بعد قراءته
                      // تحديث العداد
                      var count = parseInt(notificationBadge.textContent) - 1;
                      notificationBadge.textContent = count > 0 ? count : '';
                  }
              });
          }
      });
  });
  </script>