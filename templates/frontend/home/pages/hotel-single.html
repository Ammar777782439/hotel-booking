{% extends "frontend/layout/master.html" %}
{% load static %}

{% block content %}

<style>
  /* ====== الاتجاه العام للغة العربية ====== */
  .comment-forum {
    direction: rtl;
    text-align: right;
  }
  .star-rating {
    direction: rtl;
    display: inline-flex;
    flex-direction: row-reverse;
  }

  .star-rating input[type="radio"] {
    display: none;
  }

  .star-rating label {
    font-size: 22px; /* تم تكبير الحجم من 18px إلى 22px */
    color: #ccc;
    cursor: pointer;
    transition: color 0.2s ease-in-out;
    padding: 0 3px;
  }

  .star-rating input[type="radio"]:checked ~ label,
  .star-rating label:hover,
  .star-rating label:hover ~ label {
    color: #ffc107;
  }

  .small-stars label {
    font-size: 25px;
  }

  /* ====== تنسيق textarea ====== */
  textarea.form-control {
    resize: none;
    min-height: 100px;
  }

  /* ====== زر الإضافة للمفضلة (wishlist) ====== */
  .add-to-wishlist {
color: #6c757d; /* grey by default */
    background-color: transparent;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
  }

  .add-to-wishlist .la-heart-o {
color: #6c757d; /* grey heart */
  }

  .add-to-wishlist .la-heart {
color:red; /* white heart when selected */

  }

/* Blue button when added to wishlist */
  .btn-blue {
background-color: #007bff; /* blue background */
color: block; /* white text */
  }

  .btn-blue .la-heart {
color: red; /* white heart icon when selected */

  }

  .custom-checkbox {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
  }
  .custom-checkbox input[type="checkbox"] {
    margin-left: 8px;
  }
  .sidebar-review .ratings {
    margin-right: 0;
  }
  .sidebar-category .custom-checkbox {
    margin-bottom: 8px;
  }

  /* ====== الرسائل (Alerts) ====== */
  .messages .alert {
    padding: 15px;
    margin-bottom: 15px;
    border: 2px solid;
    border-radius: 8px;
    font-weight: bold;
  }

  .messages .alert-success {
    color: #155724;
    background-color: #d4edda;
    border-color: #c3e6cb;
  }

  .messages .alert-error {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
  }

/* يمكنك إضافة أنماط لأنواع الرسائل الأخرى مثل warning و info إذا كنت تستخدمها */
  .messages .alert-warning {
    color: #85640a;
    background-color: #fff3cd;
    border-color: #ffeeba;
  }

  .messages .alert-info {
    color: #0c5460;
    background-color: #d1ecf1;
    border-color: #bee5eb;
  }

  /* ====== تنسيق تنبيه مخصص (custom alert) ====== */
  .custom-alert.warning {
    background: rgb(205, 255, 217);
    border: 1px solid #ffeeba;
    border-radius: 8px;
    padding: 1rem;
    margin: 1.5rem 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }

  .alert-content {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
  }

  .alert-icon {
    width: 24px;
    height: 24px;
    color: rgb(7, 255, 32);
    flex-shrink: 0;
  }

  .alert-heading {
    color: #856404;
    margin: 0 0 0.5rem 0;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .custom-alert p {
    color: #856404;
    margin: 0;
    font-size: 0.95rem;
    line-height: 1.5;
  }

  /* ====== تنسيق معلومات الفندق المحسنة ====== */
  .hotel-highlight-box .highlight-content {
    background: linear-gradient(135deg, #2c3e50, #4a6491);
    transition: transform 0.3s ease;
  }

  .hotel-highlight-box .highlight-content:hover {
    transform: translateY(-3px);
  }

  .booking-stats-box {
    transition: all 0.3s ease;
  }

  .booking-stats-box:hover {
    background-color: #f8f9fa !important;
    transform: translateY(-2px);
  }

  .stats-icon {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .why-book-item {
    transition: all 0.3s ease;
    border: 1px solid transparent;
  }

  .why-book-item:hover {
    background-color: #f8f9fa;
    border-color: #e9ecef;
    transform: translateX(-5px);
  }

  .why-book-icon {
    width: 45px;
    height: 45px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .bg-success-light {
    background-color: rgba(40, 167, 69, 0.15);
  }

  .bg-info-light {
    background-color: rgba(23, 162, 184, 0.15);
  }

  .bg-gradient-primary {
    background: linear-gradient(135deg, #007bff, #0056b3);
  }

  .hover-shadow:hover {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
  }

  /* Estilos para tarjetas de hoteles de tamaño uniforme */
  .card-item {
    height: 100%;
    display: flex;
    flex-direction: column;
    margin-bottom: 20px;
  }

  .card-item .card-img {
    position: relative;
    width: 100%;
    height: 220px; /* Altura fija para todas las imágenes */
    overflow: hidden;
  }

  .card-item .card-img img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* Mantiene la proporción y cubre el área */
    object-position: center;
  }

  .card-item .card-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 20px;
  }

  .card-item .card-title {
    margin-top: 0;
    margin-bottom: 10px;
  }

  .card-item .card-price {
    margin-top: auto;
  }

  /* Estilos para las tarjetas de disponibilidad de habitaciones */
  .cabin-type-img {
    width: 200px;
    height: 150px;
    overflow: hidden;
    margin-right: 15px;
  }

  .cabin-type-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }
  </style>
    <!-- ================================
    START BREADCRUMB TOP BAR
================================= -->
<section class="breadcrumb-top-bar">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="breadcrumb-list breadcrumb-top-list">
          <ul class="list-items bg-transparent radius-none p-0">
            <li><a href="index.html">الصفحة الرئيسية</a></li>
            <li>{{hotel.location.city.country}}</li>
            <li>{{hotel.name}}</li>
          </ul>
        </div>
        <!-- end breadcrumb-list -->
      </div>
      <!-- end col-lg-12 -->
    </div>
    <!-- end row -->
  </div>
  <!-- end container -->
</section>
<!-- end breadcrumb-top-bar -->
<!-- ================================
END BREADCRUMB TOP BAR
================================= -->

<!-- ================================
START BREADCRUMB AREA
================================= -->
<section class="breadcrumb-area bread-bg-7 py-0">
  <div class="breadcrumb-wrap">
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="breadcrumb-btn">
            <div class="btn-box">
              {% comment %} <a
                class="theme-btn"
                data-fancybox="video"
                data-src="https://www.youtube.com/watch?v=5u1WISBbo5I"
                data-speed="700"
              >
                <i class="la la-video-camera me-2"></i>فيديو
              </a> {% endcomment %}

              <a
                class="theme-btn"
                data-src="{{hotel.profile_picture.url}}"
                data-fancybox="gallery"
                data-caption="Showing image - 01"
                data-speed="700"
              >
                <i class="la la-photo me-2"></i>المزيد من الصور
              </a>
            </div>
           {% for hot in hotel.images.all %}
           <a
           class="d-none"
           data-fancybox="gallery"
           data-src="{{hot.image_path.url}}"
           data-caption="Showing image - 02"
           data-speed="700"
         ></a>

           {% endfor %}
          </div>
          <!-- end breadcrumb-btn -->
        </div>
        <!-- end col-lg-12 -->
      </div>
      <!-- end row -->
    </div>
    <!-- end container -->
  </div>
  <!-- end breadcrumb-wrap -->
</section>
<!-- end breadcrumb-area -->
<!-- ================================
END BREADCRUMB AREA
================================= -->
{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}
<!-- ================================
START TOUR DETAIL AREA
================================= -->
<section class="tour-detail-area padding-bottom-90px">
  <div
    class="single-content-navbar-wrap menu section-bg"
    id="single-content-navbar"
  >
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <div class="single-content-nav" id="single-content-nav">
            <ul>
              <li>
                <a
                  data-scroll="description"
                  href="#description"
                  class="scroll-link active"
                  >تفاصيل الفندق</a
                >
              </li>
              <li>
                <a
                  data-scroll="availability"
                  href="#availability"
                  class="scroll-link"
                  >التوفر</a
                >
              </li>
              <li>
                <a
                  data-scroll="amenities"
                  href="#amenities"
                  class="scroll-link"
                  >وسائل الراحة</a
                >
              </li>
              <li>
                <a data-scroll="faq" href="#faq" class="scroll-link"
                  >التعليمات</a
                >
              </li>
              <li>
                <a data-scroll="reviews" href="#reviews" class="scroll-link"
                  >المراجعات</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- end single-content-navbar-wrap -->
  <div class="single-content-box">
    <div class="container">
      <div class="row">
        <div class="col-lg-8">
          <div class="single-content-wrap padding-top-60px">
            <div id="description" class="page-scroll">
              <div class="single-content-item pb-4">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <h3 class="title font-size-26">فندق {{hotel.name}} </h3>
                    <div class="d-flex align-items-center pt-2">
                      <p class="me-2">
                        {{hotel.location.city.state}} ، {{hotel.location.address}} ،{{hotel.location.city.country}}
                      </p>
                      <p>
                        {% if avg_rating_service %}
                        <span
                        class="badge text-bg-warning text-white font-size-16"
                        >{{avg_rating_service}}</span
                        >
                        {% endif %}
                        {% if  review_count > 0 %}
                        <span>({{review_count}} تعليقات)</span>
                        {% endif %}
                      </p>
                    </div>
                  </div>
                  {% if coupon %}
                  <div class="hotel-coupon-badge" id="couponBadge">
                    {% if coupon.discount_type == 'percent' %}
                    <span class="discount-text">{{ coupon.discount }}% خصم</span>
                    {% else %}
                    <span class="discount-text">{{ coupon.discount }} ريال خصم</span>
                    {% endif %}
                    <span class="view-coupon">عرض الكوبون</span>
                  </div>
                  {% endif %}
                </div>
              </div>

              {% if coupon %}
              <div class="hotel-coupon-modal" id="couponModal">
                <div class="coupon-modal-content">
                  <span class="close-modal">&times;</span>
                  {% include "frontend/home/components/hotel-coupon.html" %}
                </div>
              </div>

              <style>
                .hotel-coupon-badge {
                  background: linear-gradient(135deg, #287bff, #1a68e0);
                  color: white;
                  padding: 8px 15px;
                  border-radius: 30px;
                  cursor: pointer;
                  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                  transition: all 0.3s ease;
                  text-align: center;
                  margin-right: 10px;
                }

                .hotel-coupon-badge:hover {
                  transform: translateY(-2px);
                  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
                }

                .discount-text {
                  font-weight: bold;
                  font-size: 14px;
                  display: block;
                }

                .view-coupon {
                  font-size: 12px;
                  display: block;
                  margin-top: 3px;
                  opacity: 0.9;
                }

                .hotel-coupon-modal {
                  display: none;
                  position: fixed;
                  z-index: 9999;
                  left: 0;
                  top: 0;
                  width: 100%;
                  height: 100%;
                  overflow: auto;
                  background-color: rgba(0,0,0,0.5);
                }

                .coupon-modal-content {
                  background-color: #fefefe;
                  margin: 15% auto;
                  padding: 20px;
                  border-radius: 8px;
                  width: 80%;
                  max-width: 600px;
                  position: relative;
                }

                .close-modal {
                  color: #aaa;
                  float: left;
                  font-size: 28px;
                  font-weight: bold;
                  cursor: pointer;
                }

                .close-modal:hover {
                  color: black;
                }

                @media (max-width: 768px) {
                  .coupon-modal-content {
                    width: 95%;
                    margin: 30% auto;
                  }
                }
              </style>

              <script>
                document.addEventListener('DOMContentLoaded', function() {
                  const couponBadge = document.getElementById('couponBadge');
                  const couponModal = document.getElementById('couponModal');
                  const closeModal = document.querySelector('.close-modal');

                  if (couponBadge && couponModal) {
                    couponBadge.addEventListener('click', function() {
                      couponModal.style.display = 'block';
                    });

                    closeModal.addEventListener('click', function() {
                      couponModal.style.display = 'none';
                    });

                    window.addEventListener('click', function(event) {
                      if (event.target == couponModal) {
                        couponModal.style.display = 'none';
                      }
                    });
                  }
                });
              </script>
              {% endif %}
              {% if hotel_services %}
                            <!-- end single-content-item -->
              <div class="section-block"></div>
              <div class="single-content-item py-4">
                <div class="row">
                  {% for hotel_services in hotel_services %}
                  <div class="col-lg-4 responsive-column">
                    <div
                      class="single-tour-feature d-flex align-items-center mb-3"
                    >
                      <div
                        class="single-feature-icon icon-element ms-0 flex-shrink-0 me-3"
                      >
                        <i class="la {{hotel_services.icon}}"></i>
                      </div>
                      <div class="single-feature-titles">
                        <h3 class="title font-size-15 font-weight-medium">
                          {{hotel_services.name}}
                        </h3>
                        <span class="font-size-13">{{hotel_services.description}}</span>
                      </div>
                    </div>
                    <!-- end single-tour-feature -->
                  </div>
                  {% endfor %}

                </div>
                <!-- end row -->
              </div>
              <!-- end single-content-item -->
              {% endif %}

              <div class="section-block"></div>
              <div
                class="single-content-item padding-top-40px padding-bottom-40px"
              >
                <h3 class="title font-size-20">حول {{hotel.name}}  </h3>
                <p class="py-3">
                 {{hotel.description}}
                </p>

              </div>
              <!-- end single-content-item -->
              <div class="section-block"></div>
            </div>
            <!-- end description -->
            <div id="availability" class="page-scroll">
              <div
                class="single-content-item padding-top-40px padding-bottom-30px"
              >
                <h3 class="title font-size-20">التوفر</h3>

                <!-- end contact-form-action -->
                <h3 class="title font-size-20">الغرف المتاحة</h3>
                {% for availability in available_room_types %}
                <!-- start cabin-type -->
                <div onClick="window.location.href='{% url 'rooms:room_detail' availability.room_type.id %}';" class="cabin-type padding-top-30px">
                  <div class="cabin-type-item seat-selection-item d-flex">

                    <!-- Wrap the whole div with a link -->
                    <a href="{% url 'rooms:room_detail' availability.room_type.id %}" class="d-flex">

                      <div class="cabin-type-img flex-shrink-0">
                        <!-- Dynamically render the main room image -->
                        {% if availability.room_type.images.all|length > 0 %}
                          <img
                            src="{{ availability.room_type.images.all.0.image.url }}"
                            alt="{{ availability.room_type.name }}"
                          />
                        {% else %}
                          <img src="{% static 'images/placeholder.png' %}" alt="No Image Available" />
                        {% endif %}
                      </div>

                      <div class="cabin-type-detail">
                        <a href="{% url 'rooms:room_detail' availability.room_type.id %}" class="title">{{availability.room_type.name}}</a>

                        {% if availability.services %}
                          <div class="row padding-top-20px">
                            {% for service in availability.services %}
                              <div class="col-lg-6 responsive-column">
                                <div class="single-tour-feature d-flex align-items-center mb-3">
                                  <div class="single-feature-icon icon-element ms-0 flex-shrink-0 me-2">
                                    <i class="la {{service.icon}}"></i>
                                  </div>
                                  <div class="single-feature-titles">
                                    <h3 class="title font-size-15 font-weight-medium">{{service}}</h3>
                                  </div>
                                </div>
                              </div>
                            {% endfor %}
                          </div>
                        {% endif %}
                      </div>

                      <div class="cabin-price">
                        <p class="text-uppercase font-size-14">
                          لليلة الواحدة
                          <strong class="mt-n1 text-black font-size-18 font-weight-black d-block">
                            ريال{{ availability.price }}
                          </strong>
                        </p>
                      </div>
                    </a> <!-- End of the link wrapping the whole content -->

                  </div>
                </div>
                <!-- end cabin-type -->
              {% endfor %}


              </div>
              <!-- end single-content-item -->
              <div class="section-block"></div>
            </div>

            <div id="reviews" class="page-scroll">
              <div
                class="single-content-item padding-top-40px padding-bottom-40px"
              >
                <h3 class="title font-size-20">المراجعات</h3>
                <div class="review-container padding-top-30px">
                  <div class="row align-items-center">
                    <div class="col-lg-4">
                      <div class="review-summary">
                        <h2>{{reviews.count}}<span>/5</span></h2>
                        <p>ممتاز</p>
                        <span>مرتكز على {{reviews.count}} تقييمات</span>
                      </div>
                    </div>
                    <!-- end col-lg-4 -->
                    <div class="col-lg-8">
                      <div class="review-bars">
                        <div class="row">
                          <div class="col-lg-6">
                            <div class="progress-item">
                              <h3 class="progressbar-title">الخدمات</h3>
                              <div
                                class="progressbar-content line-height-20 d-flex align-items-center justify-content-between"
                              >
                                <div class="progressbar-box flex-shrink-0">
                                  <div
                                    class="progressbar-line"
                                    data-percent="70%"
                                  >
                                    <div
                                      class="progressbar-line-item bar-bg-1"
                                    ></div>
                                  </div>
                                  <!-- End Skill Bar -->
                                </div>
                                <div class="bar-percent">{{avg_rating_service}}</div>
                              </div>
                            </div>
                            <!-- end progress-item -->
                          </div>
                          <!-- end col-lg-6 -->
                          <div class="col-lg-6">
                            <div class="progress-item">
                              <h3 class="progressbar-title">الموقع</h3>
                              <div
                                class="progressbar-content line-height-20 d-flex align-items-center justify-content-between"
                              >
                                <div class="progressbar-box flex-shrink-0">
                                  <div
                                    class="progressbar-line"
                                    data-percent="55%"
                                  >
                                    <div
                                      class="progressbar-line-item bar-bg-2"
                                    ></div>
                                  </div>
                                  <!-- End Skill Bar -->
                                </div>
                                <div class="bar-percent">{{avg_rating_location}}</div>
                              </div>
                            </div>
                            <!-- end progress-item -->
                          </div>
                          <!-- end col-lg-6 -->
                          <div class="col-lg-6">
                            <div class="progress-item">
                              <h3 class="progressbar-title">قيمة المال</h3>
                              <div
                                class="progressbar-content line-height-20 d-flex align-items-center justify-content-between"
                              >
                                <div class="progressbar-box flex-shrink-0">
                                  <div
                                    class="progressbar-line"
                                    data-percent="40%"
                                  >
                                    <div
                                      class="progressbar-line-item bar-bg-3"
                                    ></div>
                                  </div>
                                  <!-- End Skill Bar -->
                                </div>
                                <div class="bar-percent">{{avg_rating_value_for_money}}</div>
                              </div>
                            </div>
                            <!-- end progress-item -->
                          </div>
                          <!-- end col-lg-6 -->
                          <div class="col-lg-6">
                            <div class="progress-item">
                              <h3 class="progressbar-title">النظافة</h3>
                              <div
                                class="progressbar-content line-height-20 d-flex align-items-center justify-content-between"
                              >
                                <div class="progressbar-box flex-shrink-0">
                                  <div
                                    class="progressbar-line"
                                    data-percent="60%"
                                  >
                                    <div
                                      class="progressbar-line-item bar-bg-4"
                                    ></div>
                                  </div>
                                  <!-- End Skill Bar -->
                                </div>
                                <div class="bar-percent">{{avg_rating_cleanliness}}</div>
                              </div>
                            </div>
                            <!-- end progress-item -->
                          </div>
                          <!-- end col-lg-6 -->

                          <!-- end col-lg-6 -->
                        </div>
                        <!-- end row -->
                      </div>
                    </div>
                    <!-- end col-lg-8 -->
                  </div>
                </div>
              </div>
              <!-- end single-content-item -->
              <div class="section-block"></div>
            </div>
            <!-- end reviews -->
            <div class="review-box">
              <div class="single-content-item padding-top-40px">
                <h3 class="title font-size-20">عرض {{reviews.count}} تقييمات من النزلاء</h3>
                <div class="comments-list padding-top-50px">
                  {% for review in reviews %}
                  <div class="comment">
                    <div class="comment-avatar">
                      {% if review.user.image %}
                      <img
                        class="avatar__img"
                        alt="{{ review.user.username }}"
                        src="{{ review.user.image.url|default:'images/default-avatar.jpg' }}" />
                        {% else %}
                        <img
                        class="avatar__img"
                        alt="{{ review.user.username }}"
                        src="{% static 'images/default-avatar.jpg' %}" />
                      {% endif %}
                    </div>
                    <div class="comment-body">
                      <div class="meta-data">
                        <h3 class="comment__author">{{ review.user.username }}</h3>
                        <div class="meta-data-inner d-flex">
                          <span class="ratings d-flex align-items-center me-1">
                            <i class="la {% if review.rating_service > 0 %} la-star {% else %} la-star-o {% endif %}"></i>
                            <i class="la {% if review.rating_service > 1 %} la-star {% else %} la-star-o {% endif %}"></i>
                            <i class="la {% if review.rating_service > 2 %} la-star {% else %} la-star-o {% endif %}"></i>
                            <i class="la {% if review.rating_service > 3 %} la-star {% else %} la-star-o {% endif %}"></i>
                            <i class="la {% if review.rating_service > 4 %} la-star {% else %} la-star-o {% endif %}"></i>

                          </span>
                          <p class="comment__date">{{ review.created_at|date:"d M Y" }}</p>
                        </div>
                      </div>
                      <p class="comment-content">{{ review.review }}</p>

                    </div>
                  </div>
                  {% empty %}
                  <p>لا توجد تقييمات حتى الآن.</p>
                  {% endfor %}
                </div>
                <div class="comment-forum padding-top-40px">
                  <div class="form-box">
                    <div class="form-title-wrap">
                      <h3 class="title">أكتب مراجعة</h3>
                    </div>
                    <!-- form-title-wrap -->
                    <div class="form-content">
                      <form method="post" action="{% url 'reviews:hotel_review_create' %}">
                        {% csrf_token %}
                        <input id="hotel_id" type="hidden" name="hotel_id" value="{{hotel.id}}" />
                        <div class="rate-option p-2">
                          <div class="row">
                            <div class="col-lg-4 responsive-column">
                              <div class="rate-option-item">
                                <label>الخدمات</label>
                                <div class="star-rating small-stars">
                                  <input type="radio" id="service-5" name="rating_service" value="5" required>
                                  <label for="service-5">★</label>
                                  <input type="radio" id="service-4" name="rating_service" value="4" required>
                                  <label for="service-4">★</label>
                                  <input type="radio" id="service-3" name="rating_service" value="3" required>
                                  <label for="service-3">★</label>
                                  <input type="radio" id="service-2" name="rating_service" value="2" required>
                                  <label for="service-2">★</label>
                                  <input type="radio" id="service-1" name="rating_service" value="1" required>
                                  <label for="service-1">★</label>
                                </div>
                              </div>
                            </div>
                            <!-- col-lg-4 -->
                            <div class="col-lg-4 responsive-column">
                              <div class="rate-option-item">
                                <label>موقع الفندق</label>
                                <div class="star-rating small-stars">
                                  <input type="radio" id="location-5" name="rating_location" value="5" required>
                                  <label for="location-5">★</label>
                                  <input type="radio" id="location-4" name="rating_location" value="4" required>
                                  <label for="location-4">★</label>
                                  <input type="radio" id="location-3" name="rating_location" value="3" required>
                                  <label for="location-3">★</label>
                                  <input type="radio" id="location-2" name="rating_location" value="2" required>
                                  <label for="location-2">★</label>
                                  <input type="radio" id="location-1" name="rating_location" value="1" required>
                                  <label for="location-1">★</label>
                                </div>
                              </div>
                            </div>
                            <!-- col-lg-4 -->
                            <div class="col-lg-4 responsive-column">
                              <div class="rate-option-item">
                                <label>سعر الفندق</label>
                                <div class="star-rating small-stars">
                                  <input type="radio" id="value-5" name="rating_value_for_money" value="5" required>
                                  <label for="value-5">★</label>
                                  <input type="radio" id="value-4" name="rating_value_for_money" value="4" required>
                                  <label for="value-4">★</label>
                                  <input type="radio" id="value-3" name="rating_value_for_money" value="3" required>
                                  <label for="value-3">★</label>
                                  <input type="radio" id="value-2" name="rating_value_for_money" value="2" required>
                                  <label for="value-2">★</label>
                                  <input type="radio" id="value-1" name="rating_value_for_money" value="1" required>
                                  <label for="value-1">★</label>
                                </div>
                              </div>
                            </div>
                            <!-- col-lg-4 -->
                            <div class="col-lg-4 responsive-column">
                              <div class="rate-option-item">
                                <label>النظافة</label>
                                <div class="star-rating small-stars">
                                  <input type="radio" id="clean-5" name="rating_cleanliness" value="5">
                                  <label for="clean-5">★</label>
                                  <input type="radio" id="clean-4" name="rating_cleanliness" value="4">
                                  <label for="clean-4">★</label>
                                  <input type="radio" id="clean-3" name="rating_cleanliness" value="3">
                                  <label for="clean-3">★</label>
                                  <input type="radio" id="clean-2" name="rating_cleanliness" value="2">
                                  <label for="clean-2">★</label>
                                  <input type="radio" id="clean-1" name="rating_cleanliness" value="1">
                                  <label for="clean-1">★</label>
                                </div>
                              </div>
                            </div>
                          </div>
                          <!-- end row -->
                        </div>
                        <!-- end rate-option -->
                        <div class="mb-3">
                          <label class="mb-2">رسالتك</label>
                          <textarea id="review_desc" name="review" class="form-control" maxlength="100" placeholder="اكتب رسالتك"></textarea>
                          <div class="d-flex justify-content-between mt-3">

                          </div>
                        </div>

                        <div class="submit-section">
                          <button type="submit" class="theme-btn btn-primary">إضافة المراجعة</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
                <!-- end comment-forum -->
              </div>
              <!-- end single-content-item -->
            </div>
            <!-- end review-box -->
          </div>
          <!-- end single-content-wrap -->
        </div>
        <!-- end col-lg-8 -->
        <div class="col-lg-4">


            <div class="sidebar-widget single-content-widget border rounded shadow-sm p-4 mb-4">
  <h3 class="title stroke-shape mb-4">معلومات الفندق</h3>

  {% if hotel.best_seller %}
  <div class="hotel-highlight-box mb-4">
    <div class="highlight-content bg-gradient-primary text-white p-3 rounded-lg">
      <div class="d-flex align-items-center">
        <div class="highlight-icon me-3">
          <i class="la la-crown fs-1 text-warning"></i>
        </div>
        <div class="highlight-text">
          <h5 class="mb-0 fw-bold">هذا الفندق من بين <span class="text-warning">الأكثر حجزًا</span>!</h5>
          <p class="mb-0 mt-1 small">اختيار مميز من قبل ضيوفنا</p>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="booking-stats-box mb-4 p-3 bg-light rounded-lg">
    <div class="d-flex align-items-center">
      <div class="stats-icon bg-primary text-white rounded-circle p-2 me-3">
        <i class="la la-book fs-3"></i>
      </div>
      <div class="stats-content">
        <h6 class="mb-1 text-muted">عدد الحجوزات المؤكدة</h6>
        <h3 class="mb-0 text-primary fw-bold">{{ hotel.booking_count }}</h3>
      </div>
    </div>
  </div>

  <div class="why-book-box">
    <h5 class="mb-3 fw-bold border-bottom pb-2">لماذا تحجز معنا؟</h5>
    <div class="why-book-items">
      <div class="why-book-item d-flex align-items-center mb-3 p-2 rounded hover-shadow">
        <div class="why-book-icon bg-success-light p-2 rounded-circle me-3">
          <i class="la la-dollar fs-4 text-success"></i>
        </div>
        <div class="why-book-text">
          <h6 class="mb-0 fw-bold">ضمان أفضل الأسعار</h6>
          <p class="mb-0 small text-muted">بدون متاعب أو رسوم إضافية</p>
        </div>
      </div>
      <div class="why-book-item d-flex align-items-center mb-2 p-2 rounded hover-shadow">
        <div class="why-book-icon bg-info-light p-2 rounded-circle me-3">
          <i class="la la-headset fs-4 text-info"></i>
        </div>
        <div class="why-book-text">
          <h6 class="mb-0 fw-bold">خدمة العملاء متوفرة 24/7</h6>
          <p class="mb-0 small text-muted">دعم متواصل طوال اليوم</p>
        </div>
      </div>
    </div>
  </div>
</div>

            <!-- end sidebar-widget -->
            <div class="sidebar-widget single-content-widget">
              <h3 class="title stroke-shape"> تواصل مع الفندق </h3>
              <p class="font-size-14 line-height-24">
                لا تتردد في الاتصال بنا. نحن فريق من الخبراء ويسعدنا التحدث
                إليكم.
              </p>
              <div class="sidebar-list pt-3">
                <ul class="list-items">
                  {% for phones in phones %}
                  <li>
                    <i class="la la-phone icon-element me-2"></i
                    ><a href="#">{{phones.country_code}} {{phones.country_code}}</a>

                  </li>
                  {% endfor %}
                  <li>
                    <i class="la la-envelope icon-element me-2"></i
                    ><a href="mailto:info@trizen.com">{{hotel.email}}</a>
                  </li>
                </ul>
              </div>
              <!-- end sidebar-list -->
            </div>
            <!-- end sidebar-widget -->

            <!-- end sidebar-widget -->
          </div>
          <!-- end sidebar -->
        </div>
        <!-- end col-lg-4 -->
      </div>
      <!-- end row -->
    </div>
    <!-- end container -->
  </div>
  <!-- end single-content-box -->
</section>
<!-- end tour-detail-area -->
<!-- ================================
END TOUR DETAIL AREA
================================= -->

<div class="section-block"></div>

<!-- ================================
START RELATE TOUR AREA
================================= -->
{% if external_hotels %}

<section class="related-tour-area section--padding">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="section-heading text-center">
          <h2 class="sec__title">قد يعجبك ايضا</h2>
        </div>
        <!-- end section-heading -->
      </div>
      <!-- end col-lg-12 -->
    </div>
    <!-- end row -->
    <div class="row padding-top-50px">
      {% for hotels in external_hotels %}

      <!-- end col-lg-4 -->
      <div class="col-lg-4 responsive-column">
        <div class="card-item">
          <div class="card-img">
            <a href="{{hotels.get_absolute_url}}" class="d-block">
              <img src="{{hotels.profile_picture.url}}" alt="hotel-img" />
            </a>
                        {% comment %} <span class="badge">متميز</span> {% endcomment %}

                        <div
                        class="add-to-wishlist icon-element {% if hotels.is_favorite %}btn-blue{% endif %}"
                        data-bs-toggle="tooltip"
                        data-placement="top"
                        data-hotel-id="{{ hotels.id }}"
                        title="المرجعية"
                      >
                        <i class="{% if hotels.is_favorite %}la la-heart{% else %}la la-heart-o{% endif %}"></i>
                      </div>
          </div>
          <div class="card-body">
            <h3 class="card-title">
              <a href="{{hotels.get_absolute_url}}">{{hotels.name}}</a>
            </h3>
            <p class="card-meta">{{hotel.location.city.state}} , {{hotels.location.address}}</p>
            <div class="card-rating">
              {% if hotels.average_rating > 0 %}

              <span class="badge text-white">{{hotels.average_rating}}/5</span>

              {% else %}
              <span class="badge text-white">0.0/5</span>

              {% endif %}
              <span class="review__text">معدل</span>
              <span class="rating__text">({{hotels.review_count}} التعليقات)</span>
            </div>
            <div class="card-price d-flex align-items-center justify-content-between">

              <a href="{{hotels.get_absolute_url}}" class="btn-text"
              >انظر التفاصيل<i class="la la-angle-right"></i
            ></a>            </div>
          </div>
        </div>
        <!-- end card-item -->
      </div>
      {% endfor %}

    </div>

    <!-- end row -->
  </div>
  <!-- end container -->
</section>


{% endif %}
<!-- end related-tour-area -->
<!-- ================================
END RELATE TOUR AREA
================================= -->

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.add-to-wishlist').forEach(function(button) {
      button.addEventListener('click', function() {
        var hotelId = this.getAttribute('data-hotel-id');
        var icon = this.querySelector('i');
        var buttonElement = this; // Explicitly reference the button

        fetch("{% url 'customer:add_to_favorites' %}", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
          },
          body: JSON.stringify({
            'hotel_id': hotelId,
          }),
        })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            // Toggle styles immediately to avoid double click issue
            buttonElement.classList.toggle('btn-blue');
            icon.classList.toggle('la-heart');
            icon.classList.toggle('la-heart-o');
          } else {
            alert(data.message || 'Something went wrong');
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
      });
    });
  });
</script>

{% endblock content %}