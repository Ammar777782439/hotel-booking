{% extends "frontend/layout/master.html" %}
{% load static %}

{% block content %}
<section class="breadcrumb-area bread-bg-9">
  <div class="breadcrumb-wrap">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-6">
          <div class="breadcrumb-content">
            <div class="section-heading">
              <h2 class="sec__title text-white">{{ post.title }}</h2>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="breadcrumb-list text-end">
            <ul class="list-items">
              <li><a href="{% url 'home:index' %}">الرئيسية</a></li>
              <li><a href="{% url 'blog:post_list' %}">المدونة</a></li>
              <li>{{ post.title }}</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="bread-svg-box">
    <svg class="bread-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 10" preserveAspectRatio="none">
      <polygon points="100 0 50 10 0 0 0 10 100 10"></polygon>
    </svg>
  </div>
</section>

<section class="card-area section--padding">
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <div class="card-item blog-card blog-card-layout-2 blog-single-card mb-5">
          <div class="card-img before-none">
            {% if post.image %}
            <img src="{{ post.image.url }}" alt="{{ post.title }}" />
            {% else %}
            <img src="{% static 'images/blog-img.jpg' %}" alt="{{ post.title }}" />
            {% endif %}
          </div>
          <div class="card-body px-0 pb-0">
            <div class="post-categories">
              <a href="{% url 'blog:post_list' %}?category={{ post.category.id }}" class="badge">{{ post.category.name }}</a>
            </div>
            <h3 class="card-title font-size-28">{{ post.title }}</h3>
            <p class="card-meta pb-3">
              <span class="post__author">بواسطة <a href="#">{{ post.author.username }}</a></span>
              <span class="post-dot"></span>
              <span class="post__date">{{ post.published_at|date }}</span>
              <span class="post-dot"></span>
              <span class="post__time">{{ post.views }} مشاهدة</span>
            </p>
            <div class="section-block"></div>
            <div class="card-text py-3">
              {{ post.content|linebreaks }}
            </div>
          </div>
        </div>

        {% if comments %}
        <div class="comments-list pt-5">
          <h3 class="title font-size-20">{{ comments.count }} تعليق</h3>
          {% for comment in comments %}
          <div class="comment {% if not forloop.first %}comment-reply{% endif %}">
            <div class="comment-body">
              <div class="meta-data">
                <h3 class="comment__author">{{ comment.author.username }}</h3>
                <span class="comment__date">{{ comment.created_at|date }}</span>
              </div>
              <p class="comment-content">
                {{ comment.content }}
              </p>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endif %}

        {% if user.is_authenticated %}
        <div class="comment-forum pt-5">
          <div class="form-box">
            <div class="form-title-wrap">
              <h3 class="title">اكتب تعليقاً</h3>
            </div>
            <div class="form-content">
              <div class="contact-form-action">
                <form method="post">
                  {% csrf_token %}
                  <div class="row">
                    <div class="col-lg-12">
                      <div class="input-box">
                        <div class="form-group mb-0">
                          <textarea class="message-control form-control" name="content" placeholder="اكتب تعليقك هنا"></textarea>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg-12">
                      <div class="btn-box pt-3">
                        <button type="submit" class="theme-btn">إرسال التعليق</button>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        {% endif %}
      </div>

      <div class="col-lg-4">
        <div class="sidebar mb-0">
          <div class="sidebar-widget">
            <h3 class="title stroke-shape">بحث</h3>
            <div class="contact-form-action">
              <form action="{% url 'blog:post_list' %}" method="get">
                <div class="input-box">
                  <div class="form-group mb-0">
                    <input class="form-control pl-3" type="text" name="search" placeholder="ابحث هنا...">
                    <button class="search-btn" type="submit"><i class="la la-search"></i></button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <div class="sidebar-widget">
            <h3 class="title stroke-shape">التصنيفات</h3>
            <div class="sidebar-category">
              {% for category in categories %}
              <div class="custom-checkbox">
                <input type="checkbox" class="form-check-input" id="cat{{ category.id }}" 
                       {% if request.GET.category|add:"0" == category.id %}checked{% endif %}
                       onclick="window.location.href='{% url 'blog:post_list' %}{% if request.GET.category|add:"0" == category.id %}?{% else %}?category={{ category.id }}{% endif %}'">
                <label for="cat{{ category.id }}">
                  {{ category.name }} <span class="font-size-13 ms-1">({{ category.post_set.count }})</span>
                </label>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}