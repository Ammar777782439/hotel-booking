<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chart of Accounts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <style>
        @import 'bootstrap/dist/css/bootstrap.min.css';

.account-row {
  transition: background-color 0.2s ease;
}

.account-row:hover {
  background-color: rgba(0, 0, 0, 0.02);
}

.child-account {
  padding-left: 2rem;
}

.account-toggle {
  cursor: pointer;
  transition: transform 0.2s ease;
}

.account-toggle.expanded {
  transform: rotate(90deg);
}

.toast {
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
}

.toast.show {
  opacity: 1;
}
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="#">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary me-2">
            <path d="M3 3v18h18"/>
            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
          </svg>
          <span class="fw-semibold">FinanceFlow</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" href="#">Chart of Accounts</a>
            </li>
            <li class="nav-item">
              <a class="nav-link disabled" href="#">Journal Entry</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container py-4">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-4">
            <div>
              <h2 class="card-title h4">Chart of Accounts</h2>
              <p class="text-muted">A hierarchical view of all accounts in your organization including their name, type, and account number.</p>
            </div>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAccountModal">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                <path d="M12 5v14M5 12h14"/>
              </svg>
              Add Account
            </button>
          </div>

          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>Account Number</th>
                  <th>Name</th>
                  <th>Type</th>
                  <th class="text-end">Actions</th>
                </tr>
              </thead>
              <tbody id="accountsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Add/Edit Account Modal -->
    <div class="modal fade" id="addAccountModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">Add New Account</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="accountForm">
              <div class="mb-3">
                <label for="accountNumber" class="form-label">Account Number</label>
                <input type="text" class="form-control" id="accountNumber" required>
              </div>
              <div class="mb-3">
                <label for="accountName" class="form-label">Account Name</label>
                <input type="text" class="form-control" id="accountName" required>
              </div>
              <div class="mb-3">
                <label for="accountType" class="form-label">Account Type</label>
                <select class="form-select" id="accountType" required>
                  <option value="Asset">Asset</option>
                  <option value="Liability">Liability</option>
                  <option value="Equity">Equity</option>
                  <option value="Revenue">Revenue</option>
                  <option value="Expense">Expense</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="saveAccount">Save Account</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Delete Account</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete this account? This action cannot be undone.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js" integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq" crossorigin="anonymous"></script>
    
    <script>

        const initialAccounts = {{ accounts|safe }};

        console.log(initialAccounts);
        alert(initialAccounts);
        let accounts = [...initialAccounts];
        let selectedAccount = null;
        
        // Bootstrap components
        const addAccountModal = new bootstrap.Modal(document.getElementById('addAccountModal'));
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        
        // Create a toast
        function showToast(message, type = 'success') {
          const toastContainer = document.querySelector('.toast-container');
          const toastHtml = `
            <div class="toast align-items-center text-white bg-${type} border-0" role="alert">
              <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
              </div>
            </div>
          `;
          toastContainer.insertAdjacentHTML('beforeend', toastHtml);
          const toast = new bootstrap.Toast(toastContainer.lastElementChild);
          toast.show();
        }
        
        // Render account row
        function createAccountRow(account, level = 0) {
          const hasChildren = account.children && account.children.length > 0;
          const toggleIcon = hasChildren ? 'â–¶' : '';
          
          return `
            <tr class="account-row" data-id="${account.id}" data-level="${level}">
              <td>
                ${hasChildren ? 
                  `<span class="account-toggle me-2" onclick="toggleAccount('${account.id}')">${toggleIcon}</span>` : 
                  '<span class="ms-4"></span>'}
                ${account.number}
              </td>
              <td>${account.name}</td>
              <td>${account.type}</td>
              <td class="text-end">
                <button class="btn btn-sm btn-link" onclick="editAccount('${account.id}')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/>
                    <path d="m15 5 4 4"/>
                  </svg>
                </button>
                <button class="btn btn-sm btn-link text-danger" onclick="deleteAccount('${account.id}')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 6h18"/>
                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                  </svg>
                </button>
              </td>
            </tr>
          `;
        }
        
        // Render accounts table
        function renderAccounts() {
          const tableBody = document.getElementById('accountsTableBody');
          let html = '';
          
          function renderAccount(account, level) {
            html += createAccountRow(account, level);
            if (account.children && account.isExpanded) {
              account.children.forEach(child => renderAccount(child, level + 1));
            }
          }
          
          accounts.forEach(account => renderAccount(account, 0));
          tableBody.innerHTML = html;
        }
        
        window.toggleAccount = function(id) {
          const account = findAccount(accounts, id);
          if (account) {
            account.isExpanded = !account.isExpanded;
            renderAccounts();
          }
        };
        
        function findAccount(accounts, id) {
          for (const account of accounts) {
            if (account.id === id) return account;
            if (account.children) {
              const found = findAccount(account.children, id);
              if (found) return found;
            }
          }
          return null;
        }
        
        // Edit account
        window.editAccount = function(id) {
          selectedAccount = findAccount(accounts, id);
          if (selectedAccount) {
            document.getElementById('modalTitle').textContent = 'Edit Account';
            document.getElementById('accountNumber').value = selectedAccount.number;
            document.getElementById('accountName').value = selectedAccount.name;
            document.getElementById('accountType').value = selectedAccount.type;
            addAccountModal.show();
          }
        };
        
        // Delete account
        window.deleteAccount = function(id) {
          selectedAccount = findAccount(accounts, id);
          if (selectedAccount) {
            deleteModal.show();
          }
        };
        
        // Save account
        document.getElementById('saveAccount').addEventListener('click', () => {
          const number = document.getElementById('accountNumber').value;
          const name = document.getElementById('accountName').value;
          const type = document.getElementById('accountType').value;
        
          if (selectedAccount) {
            // Edit existing account
            selectedAccount.number = number;
            selectedAccount.name = name;
            selectedAccount.type = type;
            showToast('Account updated successfully');
          } else {
            // Add new account
            const newAccount = {
              id: Date.now().toString(),
              number,
              name,
              type
            };
            accounts.push(newAccount);
            showToast('Account created successfully');
          }
        
          renderAccounts();
          addAccountModal.hide();
          selectedAccount = null;
          document.getElementById('accountForm').reset();
        });
        
        // Confirm delete
        document.getElementById('confirmDelete').addEventListener('click', () => {
          if (selectedAccount) {
            accounts = accounts.filter(account => account.id !== selectedAccount.id);
            renderAccounts();
            showToast('Account deleted successfully');
            deleteModal.hide();
            selectedAccount = null;
          }
        });
        
        // Reset form when modal is closed
        document.getElementById('addAccountModal').addEventListener('hidden.bs.modal', () => {
          document.getElementById('modalTitle').textContent = 'Add New Account';
          document.getElementById('accountForm').reset();
          selectedAccount = null;
        });
        
        // Initial render
        renderAccounts();      
    </script>
  </body>
</html>