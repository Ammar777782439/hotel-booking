{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static "admin/css/forms.css" %}">
  <style>
    .permissions-container {
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .app-section {
      background: white;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .app-title {
      font-size: 1.2em;
      color: #2c3e50;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #eee;
    }

    .model-section {
      background: #f8f9fa;
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
    }

    .model-title {
      font-size: 1.1em;
      color: #34495e;
      margin-bottom: 10px;
    }

    .permission-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 10px;
      margin: 10px 0;
    }

    .permission-item {
      display: flex;
      align-items: center;
      padding: 8px;
      background: white;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    .permission-item:hover {
      background: #e8f4fd;
    }

    .permission-checkbox {
      width: 20px;
      height: 20px;
      margin-left: 10px;
      cursor: pointer;
    }

    .permission-label {
      cursor: pointer;
      font-size: 0.95em;
      color: #444;
      flex: 1;
    }

    .select-all-section {
      background: #e3f2fd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 6px;
      display: flex;
      align-items: center;
    }

    .select-all-checkbox {
      width: 20px;
      height: 20px;
      margin-left: 10px;
      cursor: pointer;
    }

    .select-all-label {
      font-size: 1em;
      color: #1976d2;
      cursor: pointer;
    }

    .submit-row {
      background: white;
      padding: 15px;
      margin-top: 20px;
      border-radius: 6px;
      text-align: left;
    }

    .submit-button {
      background: #2196f3;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1em;
    }

    .submit-button:hover {
      background: #1976d2;
    }
  </style>
{% endblock %}

{% block content %}
<div class="permissions-container">
  <form method="post">
    {% csrf_token %}
    
    <div class="select-all-section">
      <input type="checkbox" id="select-all" class="select-all-checkbox" onchange="toggleAll(this)">
      <label for="select-all" class="select-all-label">تحديد/إلغاء تحديد الكل</label>
    </div>
    {% if request.user.is_superuser or request.user.user_type == 'admin' %}
    {% for app_label, models in organized_permissions.items %}
    <div class="app-section">
      <div class="app-title">{{ app_label }}</div>
      
      {% for model_name, data in models.items %}
      <div class="model-section">
        <div class="model-title">{{ model_name }}</div>
        
        <div class="permission-list">
        
        
          {% for permission in data.permissions %}
          <div class="permission-item">
            <input type="checkbox" 
                   class="permission-checkbox"
                   name="permissions" 
                   value="{{ permission.id }}" 
                   id="permission_{{ permission.id }}"
                   {% if permission in data.selected %}checked{% endif %}>
            <label class="permission-label" for="permission_{{ permission.id }}">
              {{ permission.name }}
            </label>
          </div>
          {% endfor %}
        </div>
        
      </div>
      {% endfor %}
    </div>
    {% endfor %}
    
     
     {% else %}
     {% endif %}
        

    <div class="submit-row">
      <input type="submit" value="حفظ الصلاحيات" class="submit-button" name="_save">
    </div>
  </form>
</div>

<script>
function toggleAll(source) {
  var checkboxes = document.getElementsByName('permissions');
  for(var i=0, n=checkboxes.length; i<n; i++) {
    checkboxes[i].checked = source.checked;
  }
}
</script>
{% endblock %}
