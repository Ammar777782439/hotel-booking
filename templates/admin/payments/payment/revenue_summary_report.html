{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block extrastyle %}
    {{ block.super }}
    {# More refined styles #}
        <!-- Google Fonts -->
        <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&display=swap"
        rel="stylesheet"
      />
      {% comment %} <script src="{% static 'assets/css/chat.css' %}"></script> {% endcomment %}
  
      <!-- Template CSS Files -->
      <link rel="stylesheet" href="{% static 'css/bootstrap-rtl.min.css' %}" />
      <link rel="stylesheet" href="{% static 'css/line-awesome.css' %}" />
      <!-- jQuery UI CSS قبل Bootstrap لتجنب تعارض النوافذ المنبثقة -->
      <link rel="stylesheet" href="{% static 'css/jquery-ui.css' %}" />
      <link rel="stylesheet" href="{% static 'css/select2.min.css' %}" />
      <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}" />
      <link
        rel="stylesheet"
        href="{% static 'css/owl.theme.default.min.css' %}"
      />
      <link rel="stylesheet" href="{% static 'css/jquery.fancybox.min.css' %}" />
      <link rel="stylesheet" href="{% static 'css/daterangepicker.css' %}" />
      <link rel="stylesheet" href="{% static 'css/animated-headline.css' %}" />
      <link rel="stylesheet" href="{% static 'css/jquery.filer.css' %}" />
      <link rel="stylesheet" href="{% static 'css/flag-icon.min.css' %}" />
      <link rel="stylesheet" href="{% static 'css/style.css' %}" />
      <link rel="stylesheet" href="{% static 'css/style-rtl.css' %}" />
      <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      />
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-list report-container{% endblock %} {# Added report-container class #}

{% block content_title %}
    {# Title is now inside the summary box or handled by report-summary h2 #}
{% endblock %}

{% block content %}
    <div id="content-main">
        {# Add back object-tools to include the export button #}
        {% block object-tools %}
            <ul class="object-tools">
                {% block object-tools-items %}
                    {# Add link to export PDF #}
                    {% if pdf_export_url %}
                    <li>
                        {# Pass current date filters to the export URL #}
                        <a href="{{ pdf_export_url }}?start_date={{ start_date }}&end_date={{ end_date }}" class="addlink">
                            {% trans "Export as PDF" %}
                        </a>
                    </li>
                    {% endif %}
                {% endblock %}
            </ul>
        {% endblock %}

        <div class="module" id="changelist">

            {# Date Filter Form - Now styled better #}
            <div class="date-filter-form">
                <form method="get" action="">
                    <label for="start_date">{% trans "From Date:" %}</label>
                    <input type="date" id="start_date" name="start_date" value="{{ start_date }}">

                    <label for="end_date">{% trans "To Date:" %}</label>
                    <input type="date" id="end_date" name="end_date" value="{{ end_date }}">

                    <button type="submit" class="button">{% trans "Filter" %}</button>
                </form>
            </div>

            {# Revenue Summary Section - Now styled better #}
            <div class="report-summary">
                <h2>{% trans title %}</h2> {# Moved title here #}
                <p>{% trans "Period:" %} {{ start_date }} - {{ end_date }}</p>
                <p>{% trans "Total Confirmed Revenue:" %} <strong>{{ total_revenue|floatformat:2 }}</strong></p>
            </div>

            {# Revenue by Payment Method Table - Now styled better #}
            {% if revenue_by_method %}
                <div class="results results-section"> {# Added results-section class #}
                    <h2>{% trans "Revenue by Payment Method" %}</h2>
                    <table id="result_list">
                        <thead>
                            <tr>
                                <th scope="col">{% trans "Payment Method" %}</th>
                                <th scope="col">{% trans "Number of Payments" %}</th>
                                <th scope="col">{% trans "Total Revenue" %}</th>
                                <th scope="col">{% trans "Currency" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for method_data in revenue_by_method %}
                                <tr class="{% cycle 'row1' 'row2' %}">
                                    <td>{{ method_data.payment_method__payment_option__method_name }}</td>
                                    <td>{{ method_data.method_count }}</td>
                                    <td style="direction: ltr; text-align: right;">{{ method_data.method_total|floatformat:2 }}</td> {# Added styling for consistency #}
                                    <td>{{ method_data.payment_method__payment_option__currency__currency_symbol }}</td> {# Correct variable is already used, ensure data is passed correctly #}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p>{% trans "No confirmed payments found for the selected period." %}</p>
            {% endif %}
        </div>
    </div>
{% endblock %}
